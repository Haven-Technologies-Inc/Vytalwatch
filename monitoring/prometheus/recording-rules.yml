groups:
  - name: vytalwatch_recording_rules
    interval: 30s
    rules:
      # Request rate by endpoint
      - record: job:http_requests:rate5m
        expr: rate(http_requests_total{job="vytalwatch"}[5m])

      # Error rate by endpoint
      - record: job:http_errors:rate5m
        expr: rate(http_requests_total{job="vytalwatch",status=~"5.."}[5m])

      # P95 latency
      - record: job:http_request_duration:p95
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{job="vytalwatch"}[5m]))

      # P99 latency
      - record: job:http_request_duration:p99
        expr: histogram_quantile(0.99, rate(http_request_duration_seconds_bucket{job="vytalwatch"}[5m]))

      # Database query duration
      - record: job:db_query_duration:p95
        expr: histogram_quantile(0.95, rate(db_query_duration_seconds_bucket[5m]))
